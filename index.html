<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工時計算 App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>工時計算器</h1>
            <div class="settings-toggle">
                <button id="settingsBtn">⚙️ 設定</button>
            </div>
        </header>

        <!-- 設定面板 (預設隱藏) -->
        <div id="settingsPanel" class="card hidden">
            <h3>⚙️ 設定</h3>
            
            <div class="settings-section">
                <h4>基本設定</h4>
                <div class="form-group">
                    <label for="hourlyWage">時薪 (TWD)</label>
                    <input type="number" id="hourlyWage" value="183">
                </div>
                <div class="form-group">
                    <label for="breakTime">預設休息時間 (分鐘)</label>
                    <input type="number" id="breakTime" value="60">
                </div>
            </div>

            <div class="settings-section">
                <h4>💾 資料備份與還原</h4>
                <p class="hint-text">可將資料下載為檔案，或使用「文字代碼」在手機間轉移。</p>
                <div class="action-buttons-small">
                    <button id="backupBtn" class="btn-outline">⬇️ 下載備份檔</button>
                    <button id="restoreBtn" class="btn-outline">⬆️ 還原備份檔</button>
                    <input type="file" id="restoreInput" accept=".json" style="display: none;">
                </div>
                
                <!-- 手機版文字備份 -->
                <div style="margin-top: 15px;">
                    <button id="toggleTextBackupBtn" class="btn-text" style="font-size: 0.9rem;">📱 手機版專用：文字備份/還原</button>
                    <div id="textBackupArea" style="display: none; margin-top: 10px;">
                        <textarea id="backupTextarea" rows="5" placeholder="備份代碼將顯示於此，或在此貼上代碼以還原..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: monospace; font-size: 0.8rem;"></textarea>
                        <div class="action-buttons-small" style="margin-top: 5px;">
                            <button id="copyTextBtn" class="btn-small">📋 複製</button>
                            <button id="shareTextBtn" class="btn-small" style="display: none;">📤 分享</button>
                            <button id="importTextBtn" class="btn-secondary">📥 還原</button>
                        </div>
                        <p class="hint-text" style="margin-top: 5px; color: #888;">提示：若 LINE 瀏覽器無法複製，請長按文字框手動全選複製，或使用「分享」按鈕。</p>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h4>☁️ Google Sheets 同步 (進階)</h4>
                <p class="hint-text">設定後可跨裝置同步。需至 Google Cloud Console 申請 Client ID。</p>
                <div class="form-group">
                    <label>Client ID</label>
                    <input type="text" id="gClientId" placeholder="請輸入 OAuth 2.0 Client ID">
                </div>
                <div class="form-group">
                    <label>Spreadsheet ID (試算表 ID)</label>
                    <input type="text" id="gSheetId" placeholder="請輸入 Google 試算表 ID">
                </div>
                <div class="action-buttons-small">
                    <button id="gAuthBtn" class="btn-google">🔗 登入並同步</button>
                    <button id="gSyncBtn" class="btn-secondary hidden">🔄 立即同步</button>
                    <div id="gStatus" class="status-text">尚未連結</div>
                </div>
            </div>

            <button id="saveSettings" class="btn-primary full-width">儲存設定</button>
        </div>

        <!-- 核心功能：打卡區 -->
        <div class="card main-action">
            <div id="clockDisplay" class="clock">00:00:00</div>
            <div class="date-display" id="dateDisplay">YYYY-MM-DD</div>
            
            <div class="action-buttons">
                <button id="clockInBtn" class="btn-large start">上班打卡</button>
                <button id="clockOutBtn" class="btn-large end" disabled>下班打卡</button>
            </div>
            
        </div>

        <!-- 手動輸入/補登 -->
        <div class="card">
            <div class="card-header" id="toggleManualBtn">
                <h3>📝 手動新增紀錄</h3>
            </div>
            <div class="card-body" id="manualEntryForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>日期</label>
                        <input type="date" id="manualDate">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>上班時間</label>
                        <input type="time" id="manualStartTime">
                    </div>
                    <div class="form-group">
                        <label>下班時間</label>
                        <input type="time" id="manualEndTime">
                    </div>
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="manualBreak" checked>
                    <label for="manualBreak">扣除休息</label>
                    <input type="number" id="manualBreakMinutes" value="60" min="0" style="width: 60px; margin: 0 5px;">
                    <span>分鐘</span>
                </div>
                <button id="addManualRecord" class="btn-secondary">新增紀錄</button>
            </div>
        </div>

        <!-- 補登休息時間 -->
        <div class="card">
            <div class="card-header" id="toggleCorrectionBtn">
                <h3>🛠️ 補登/修改休息時間</h3>
            </div>
            <div class="card-body" id="correctionForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>選擇日期</label>
                        <input type="date" id="correctionDate">
                    </div>
                    <div class="form-group">
                        <label>新休息時間 (分鐘)</label>
                        <input type="number" id="correctionBreakMinutes" min="0" placeholder="輸入分鐘數">
                    </div>
                </div>
                <div id="correctionStatus" style="margin-bottom: 10px; color: var(--text-secondary); font-size: 0.9rem;"></div>
                <button id="updateBreakBtn" class="btn-secondary">更新紀錄</button>
            </div>
        </div>

        <!-- 備忘錄 / 獎金紀錄 -->
        <div class="card">
            <div class="card-header">
                <h3>💡 備忘錄 / 獎金紀錄</h3>
            </div>
            <div class="card-body">
                <div class="form-row">
                    <div class="form-group">
                        <label>日期</label>
                        <input type="date" id="bonusDate">
                    </div>
                    <div class="form-group">
                        <label>金額 (TWD)</label>
                        <input type="number" id="bonusAmount" min="0" placeholder="例如 5000">
                    </div>
                </div>
                <div class="form-group">
                    <label>備註</label>
                    <input type="text" id="bonusNote" placeholder="例如：Altis 成交獎金">
                </div>
                <button id="addBonus" class="btn-secondary">新增備忘錄</button>
                <div class="bonus-summary" id="bonusSummary">本月獎金合計：$0</div>
                <div class="bonus-list" id="bonusList">
                    <div class="empty-state">尚無備忘錄</div>
                </div>
            </div>
        </div>

        <!-- 統計看板 -->
        <div class="stats-container">
            <div class="stat-card">
                <h4>今日時數</h4>
                <div class="value" id="todayHours">0.0</div>
            </div>
            <div class="stat-card">
                <h4>本月累積</h4>
                <div class="value" id="monthHours">0.0</div>
            </div>
            <div class="stat-card">
                <h4>區間總計</h4>
                <div class="value" id="rangeHours">0.0</div>
            </div>
            <div class="stat-card">
                <h4>預估薪資（時薪）</h4>
                <div class="value" id="monthSalary">$0</div>
            </div>
            <div class="stat-card">
                <h4>獎金/其他</h4>
                <div class="value" id="bonusOnly">$0</div>
            </div>
            <div class="stat-card">
                <h4>本月總收入（時薪＋獎金）</h4>
                <div class="value" id="totalIncome">$0</div>
            </div>
        </div>

        <!-- 歷史紀錄與篩選 -->
        <div class="card history-section">
            <div class="history-header">
                <h3>工時紀錄</h3>
                <div class="filter-controls">
                    <input type="date" id="filterStart">
                    <span>至</span>
                    <input type="date" id="filterEnd">
                    <button id="clearFilter" class="btn-small">重置</button>
                </div>
            </div>
            
            <div class="action-bar">
                <button id="exportBtn" class="btn-outline">📥 匯出 Excel</button>
                <button id="deleteAllBtn" class="btn-danger-outline">🗑️ 清空所有紀錄</button>
            </div>
            
            <div class="records-list" id="recordsList">
                <!-- 紀錄項目將由 JS 生成 -->
                <div class="empty-state">尚無紀錄</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <!-- Google API Scripts -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
</body>
</html>
